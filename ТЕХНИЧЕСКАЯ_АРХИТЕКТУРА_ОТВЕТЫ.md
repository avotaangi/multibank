# Ответы на вопросы о технической архитектуре

## 1. Техническая архитектура

Прототип: MultiBank реализован как Telegram Mini App. Frontend (React 18.2 + Vite) работает в Telegram WebView, использует Zustand для состояния и React Query для API. Backend API Gateway на Node.js/Express (порт 3001) или FastAPI выступает единой точкой входа, обеспечивает JWT аутентификацию, валидацию, rate limiting и проксирование запросов к Open Banking API трех банков (VBank, ABank, SBank). MongoDB хранит данные пользователей, счетов и транзакций. Единый BankingClient управляет токенами доступа и унифицированным интерфейсом. Доступ через Telegram Bot. Финальное решение: будет вкладкой в приложении банка, Frontend встраивается через WebView (iOS WKWebView, Android WebView), аутентификация через приложение банка (OAuth2/OpenID Connect, SSO, биометрия). Backend и база данных остаются без изменений. Архитектура поддерживает горизонтальное масштабирование, stateless API, развертывание через Docker.

## 2. Ссылка на описание технической архитектуры

https://github.com/yourusername/multibank/blob/master/ARCHITECTURE.md


## 3. Используемые технологии

Прототип: Frontend - React 18.2, React Router v6, Zustand 4.5.7, React Query 3.39.3, Axios 1.6.2, Tailwind CSS 3.3.6, Vite 5.0.0, Lucide React, React Hook Form. Backend (Node.js): Express 4.18.2, Mongoose 8.0.3, JWT, bcryptjs, express-rate-limit, Helmet, CORS, express-validator, Morgan. Backend (FastAPI): FastAPI, Motor, Pydantic, python-jose, passlib, httpx. База данных: MongoDB. Telegram: Telegram Bot API, Telegram WebApp API. Интеграция в приложение банка: WebView (iOS WKWebView, Android WebView) для встраивания React приложения, OAuth2/OpenID Connect для аутентификации, биометрия (Face ID, Touch ID, Android Biometric API), нативные мосты для взаимодействия с приложением банка. Инструменты: Vite, ESLint, PostCSS, Nodemon, Jest. Деплой: Docker, Vercel, PM2. Внешние API: Open Banking API (VBank, ABank, SBank).

## 4. API и интеграции

Прототип: Интеграция с Open Banking API трех банков: VBank, ABank, SBank. Единый BankingClient управляет Bearer токенами, кеширует их. Реализованы: Payments API, Consents API, Products API, Rewards API, Leads API, Credit Products API, Cash Loan Applications API, Card Management API, Card Operations API, Universal Payments API, Mobile Payments API. Backend как API Gateway проксирует запросы с заголовками Authorization, Correlation-ID, X-Global-Transaction-ID. Аутентификация через Telegram Bot API и Telegram WebApp API (initData). Финальное решение: интеграция с Open Banking API без изменений, дополнительно интеграция с внутренними API банка через нативные мосты, аутентификация через приложение банка (OAuth2/OpenID Connect, SSO), биометрия для подтверждения операций.

## 5. База данных

Прототип: MongoDB (NoSQL) с тремя коллекциями. `users`: telegramId (уникальный), username, firstName, lastName, email, phone, isActive, isVerified, lastLogin, preferences, security (twoFactorEnabled, pinHash). Индексы: telegramId, email, createdAt. `accounts`: userId, accountNumber (уникальный, автогенерация), accountType (checking, savings, credit, investment), currency, balance, availableBalance, creditLimit, interestRate, status, isDefault, metadata. Индексы: userId+accountType, accountNumber, status. `transactions`: transactionId (уникальный), fromAccount, toAccount, userId, type (transfer, deposit, withdrawal, payment, refund), category, amount, currency, exchangeRate, description, status, reference, metadata, fees, processedAt. Индексы: userId+createdAt, fromAccount+createdAt, toAccount+createdAt, type+status, transactionId. Timestamps на всех моделях. Mongoose или Motor. Финальное решение: структура БД без изменений, в `users` вместо telegramId используется bankUserId.

## 6. Безопасность

Многоуровневая защита на каждом этапе. Прототип: Аутентификация через верификацию Telegram WebApp (initData), JWT токены с автоматическим обновлением, проверка активности пользователя. Хеширование PIN-кодов через bcryptjs (12 раундов). Защита от атак: Helmet (security headers), express-rate-limit (100 запросов/15 мин на IP), CORS с белым списком, валидация данных (express-validator/Pydantic). Сетевая безопасность: HTTPS, защита от XSS/CSRF, ограничение размера запроса (10mb). Безопасность данных: PIN исключаются из ответов, токены в памяти, автоочистка истекших токенов. Финальное решение: единый вход (SSO), авторизация через биометрию или код банка (OAuth2/OpenID Connect), крупные транзакции >100 000 Р требуют подтверждения. Стандарты и хранение: соответствие Open API (СТО БР ФАПИ.СЕК-1.6-2020), ФЗ-152, данные хранятся и обрабатываются в РФ, обезличиваются. Инфраструктура: антифрод в реальном времени. Прозрачность: блокчейн-технология. Остальные меры безопасности без изменений.
